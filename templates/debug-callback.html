<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OIDC Mockery - Debug Callback</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .debug-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .debug-section {
            margin: 2rem 0;
            padding: 1rem;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .debug-info {
            background: #e9ecef;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }
        .json-pretty {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        .back-button {
            display: inline-block;
            padding: 8px 16px;
            background: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin: 1rem 0;
        }
        .back-button:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç OIDC Debug Callback Results</h1>
        <a href="/debug/login" class="back-button">‚Üê Back to Debug Login</a>
        
        {{if .Error}}
        <div class="debug-section error">
            <h2>‚ùå Authorization Error</h2>
            <div class="debug-info">Error: {{.Error}}
Error Description: {{.ErrorDescription}}</div>
        </div>
        {{else}}
        <div class="debug-section success">
            <h2>‚úÖ Authorization Callback Received</h2>
            <div class="debug-info">Authorization Code: {{.Code}}
State: {{.State}}</div>
        </div>
        {{end}}
        
        {{if .TokenResponse}}
        <div class="debug-section success">
            <h2>üé´ Token Exchange Successful</h2>
            <div class="debug-info">Access Token: {{.TokenResponse.AccessToken}}
Token Type: {{.TokenResponse.TokenType}}
Expires In: {{.TokenResponse.ExpiresIn}} seconds
ID Token: {{.TokenResponse.IDToken}}</div>
        </div>
        {{else if .TokenError}}
        <div class="debug-section error">
            <h2>‚ùå Token Exchange Failed</h2>
            <div class="debug-info">{{.TokenError}}</div>
        </div>
        {{end}}
        
        {{if .ParsedJWT}}
        <div class="debug-section">
            <h2>üîê JWT ID Token Parsed</h2>
            
            <h3>JWT Header</h3>
            <div class="json-pretty">{{.JWTHeaderJSON}}</div>
            
            <h3>JWT Payload (Claims)</h3>
            <div class="json-pretty">{{.JWTPayloadJSON}}</div>
            
            <h3>Decoded Claims</h3>
            <div class="debug-info">Subject    (sub): {{index .ParsedJWT "sub"}}
Name      (name): {{index .ParsedJWT "name"}}
Email    (email): {{index .ParsedJWT "email"}}
Issuer     (iss): {{index .ParsedJWT "iss"}}
Audience   (aud): {{index .ParsedJWT "aud"}}
Issued At  (iat): {{index .ParsedJWT "iat"}} ({{.IssuedAtTime}})
Expires At (exp): {{index .ParsedJWT "exp"}} ({{.ExpiresAtTime}})</div>
        </div>
        {{else if .JWTError}}
        <div class="debug-section error">
            <h2>‚ùå JWT Parsing Failed</h2>
            <div class="debug-info">{{.JWTError}}</div>
        </div>
        {{end}}
        
        <div class="debug-section">
            <h2>üîÑ Try Again</h2>
            <p>Want to test the flow again?</p>
            <a href="/debug/login" class="back-button">Start New Debug Session</a>
        </div>
    </div>
</body>
</html>
